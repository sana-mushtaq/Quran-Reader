# Islamic App

## Overview

This is a comprehensive Islamic mobile application built with Expo (React Native) and an Express backend server. The app works fully offline with bundled local data. Features include: Quran reading with Arabic text and English translations for all 114 surahs, audio recitation (Al Afasy edition), daily verse, bookmarks, Namaz (prayer) timings calculated locally, Tasbih counter with multiple dhikr phrases, curated Dua collection with categories, and Hadith section. It supports both light and dark themes with an Islamic-inspired color palette (emerald, gold, cream).

## User Preferences

Preferred communication style: Simple, everyday language.
Offline-first: App must work without internet. All data bundled locally. No API dependencies for core features.

## System Architecture

### Frontend (Expo / React Native)
- **Framework**: Expo SDK 54 with React Native 0.81, using the new architecture
- **Routing**: Expo Router v6 with file-based routing and typed routes
  - Tab layout at `app/(tabs)/` with five tabs: Home (daily verse + prayer times), Quran (browse 114 surahs), Tasbih (dhikr counter), Dua (supplications), More (Hadith + Bookmarks)
  - Dynamic route `app/surah/[id].tsx` for individual surah detail/reading view
- **State Management**: React Context (`QuranProvider` in `lib/quran-context.tsx` for bookmarks and audio, `TasbihProvider` in `lib/tasbih-context.tsx` for counter state), plus TanStack React Query available for any future server data fetching
- **Data Persistence**: AsyncStorage for bookmarks, tasbih stats, prayer location, and hadith favorites
- **Audio**: `expo-av` for Quran recitation playback with background audio support (audio URLs are bundled in local data, streaming requires internet)
- **Fonts**: Google Fonts — Inter (UI text) and Amiri (Arabic text)
- **Styling**: StyleSheet-based with a custom theme system (`constants/colors.ts`) supporting light/dark modes via `useColorScheme`

### Offline Data Architecture
- **Quran Data**: Complete Quran (all 114 surahs, 6236 ayahs) bundled as JSON files in `assets/data/`:
  - `surah-list.json` — metadata for all 114 surahs (name, English name, number of ayahs, revelation type)
  - `quran-data.json` (~3.16 MB) — full Arabic text, English translations (en.asad), and audio URLs for every ayah
  - Generated by `scripts/download-quran-data.js` from Al Quran Cloud API (run once during development)
- **Prayer Times**: Calculated locally using the `adhan` npm library (astronomical calculation), no API needed. Uses Muslim World League calculation method. Location stored in AsyncStorage with Makkah as default.
- **Hijri Date**: Calculated locally using Julian Day Number conversion algorithm
- **Dua Data**: 30 curated authentic supplications across 8 categories, hardcoded in `lib/dua-data.ts`
- **Hadith Data**: 20 curated authentic hadiths from major collections, hardcoded in `lib/hadith-api.ts`

### Backend (Express)
- **Framework**: Express 5 running on Node.js with TypeScript (compiled via tsx in dev, esbuild for production)
- **Purpose**: Primarily serves as an API proxy/server and serves the static web build in production. Currently has minimal custom routes defined in `server/routes.ts`
- **CORS**: Dynamic CORS configuration based on Replit environment variables, also allows localhost origins for Expo web development
- **Storage**: In-memory storage (`MemStorage` class in `server/storage.ts`) implementing an `IStorage` interface with basic user CRUD

### Build & Deployment
- **Development**: Two parallel processes — `expo:dev` for the mobile/web app and `server:dev` for the Express backend
- **Production**: Custom build script (`scripts/build.js`) handles static web export from Expo, then Express serves the built files
- **Path Aliases**: `@/*` maps to project root, `@shared/*` maps to `./shared/`

### Key Design Patterns
- **Offline-first**: All core features work without internet. Audio streaming is the only feature requiring connectivity.
- **Shared code**: The `shared/` directory contains schema definitions used by both frontend and backend
- **Error handling**: Custom ErrorBoundary component wrapping the entire app with a user-friendly fallback UI
- **Platform adaptation**: Components handle web vs native differences (e.g., `KeyboardAwareScrollViewCompat`, platform-specific tab layouts with liquid glass support on iOS 26+)

## Key Files

- `lib/quran-api.ts` — Quran data access layer (reads from local JSON, no network calls)
- `lib/prayer-times.ts` — Prayer time calculation using adhan library
- `lib/quran-context.tsx` — React context for bookmarks and audio playback
- `lib/tasbih-context.tsx` — React context for tasbih counter state with AsyncStorage persistence
- `lib/dua-data.ts` — Curated dua collection (30 duas, 8 categories)
- `lib/hadith-api.ts` — Curated hadith collection (20 hadiths)
- `assets/data/quran-data.json` — Complete Quran data (Arabic + English + audio URLs)
- `assets/data/surah-list.json` — Surah metadata list
- `scripts/download-quran-data.js` — One-time script to download Quran data from API

## External Dependencies

- **adhan**: npm library for astronomical prayer time calculation (works fully offline)
- **AsyncStorage**: Local device storage for persisting bookmarks, tasbih stats, prayer location, and hadith favorites
- **Google Fonts**: Inter and Amiri fonts loaded via `@expo-google-fonts` packages
- **Expo Services**: Standard Expo build and development infrastructure
- **Audio CDN** (optional, internet needed): Audio recitation files are hosted on Al Quran Cloud CDN — URLs bundled in local data, but streaming requires internet
